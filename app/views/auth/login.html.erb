<h1>Вход / Регистрация</h1>
<form id="login-form">
  <label>Email</label>
  <input type="email" name="email" required>
  <label>Пароль</label>
  <input type="password" name="password" required>
  <button type="submit">Продолжить</button>
</form>
<p><a href="/auth/forgot">Забыли пароль?</a></p>
<script>
document.getElementById('login-form').addEventListener('submit', async (e) => {
  e.preventDefault();
  const email = e.target.email.value.trim();
  const password = e.target.password.value;
  const res = await fetch('/api/v1/auth', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email, password }) });
  const data = await res.json();
  
  if (res.status === 201 || data.requires_verification) {
    sessionStorage.setItem('pending_email', data.email || email);
    window.location.href = '/auth/verify';
    return;
  }
  if (res.ok && data.token) {
    localStorage.setItem('token', data.token);
    window.location.href = '/';
    return;
  }
  alert(data.error || 'Ошибка входа');
});
</script>


