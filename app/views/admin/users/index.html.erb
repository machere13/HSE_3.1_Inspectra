<main class="PageAdminUsersIndex">
  <h1><%= t('admin.users.index.title') %></h1>

  <%= render 'shared/organisms/O_ControlPanelTable',
      title: t('admin.users.index.statistics') do %>
    <%= render 'shared/collections/C_ControlPanelTableHeaderRow', cells: [
      'Statistic',
      'Count'
    ] %>
    <%= render 'shared/collections/C_ControlPanelTableRow', cells: [
      t('admin.users.index.total'),
      @stats[:total]
    ] %>
    <%= render 'shared/collections/C_ControlPanelTableRow', cells: [
      t('admin.users.index.super_admins'),
      @stats[:super_admins]
    ] %>
    <%= render 'shared/collections/C_ControlPanelTableRow', cells: [
      t('admin.users.index.admins'),
      @stats[:admins]
    ] %>
    <%= render 'shared/collections/C_ControlPanelTableRow', cells: [
      t('admin.users.index.moderators'),
      @stats[:moderators]
    ] %>
    <%= render 'shared/collections/C_ControlPanelTableRow', cells: [
      t('admin.users.index.regular'),
      @stats[:regular]
    ] %>
  <% end %>

  <h2><%= t('admin.users.index.filters') %></h2>
  <p>
    <%= link_to t('admin.users.index.all'), admin_users_path, class: (@role_filter.blank? ? 'active' : '') %> |
    <%= link_to t('admin.users.index.super_admins'), admin_users_path(role: 'super_admin'), class: (@role_filter == 'super_admin' ? 'active' : '') %> |
    <%= link_to t('admin.users.index.admins'), admin_users_path(role: 'admin'), class: (@role_filter == 'admin' ? 'active' : '') %> |
    <%= link_to t('admin.users.index.moderators'), admin_users_path(role: 'moderator'), class: (@role_filter == 'moderator' ? 'active' : '') %> |
    <%= link_to t('admin.users.index.regular'), admin_users_path(role: 'user'), class: (@role_filter == 'user' ? 'active' : '') %>
  </p>

  <% if @pagy.count > 0 %>
    <p><%= @pagy.from %>-<%= @pagy.to %> из <%= @pagy.count %></p>
  <% end %>

  <%= render 'shared/organisms/O_ControlPanelTable',
      title: t('admin.users.index.title') do %>
    <% if @users.any? %>
      <%= render 'shared/collections/C_ControlPanelTableHeaderRow', cells: [
        'ID',
        'Email',
        t('admin.users.index.role'),
        t('admin.users.index.email_verified'),
        t('admin.users.index.registered'),
        t('admin.users.index.actions')
      ] %>
      <% @users.each do |user| %>
        <%= render 'shared/collections/C_ControlPanelTableRow', cells: [
          user.id,
          link_to(user.email, admin_user_path(user)),
          t("admin.users.roles.#{user.role}"),
          user.email_verified? ? t('admin.users.index.yes') : t('admin.users.index.no'),
          user.created_at.in_time_zone.strftime('%d.%m.%Y %H:%M'),
          "#{link_to(t('admin.users.index.view'), admin_user_path(user))} | #{link_to(t('admin.users.index.edit'), edit_admin_user_path(user))}".html_safe
        ] %>
      <% end %>
    <% else %>
      <p>No users found</p>
    <% end %>
  <% end %>

  <%= pagy_nav(@pagy) if @pagy.pages > 1 %>
</main>

